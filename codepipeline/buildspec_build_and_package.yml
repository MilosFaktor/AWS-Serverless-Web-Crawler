version: 0.2

cache:
  paths:
    - '/root/.cache/pip/**/*'        # Python pip cache
    - '/root/.npm/**/*'              # npm cache  
    - '/root/.sam/**/*'              # SAM CLI cache
    - 'serverless-app-sam/node_modules/**/*'            # Node dependencies
    - 'serverless-app-sam/.aws-sam/deps/**/*'  # Project-specific SAM deps

phases:
  install:
    runtime-versions:
      python: 3.11
      nodejs: 20                    
    commands:
      - echo "üì¶ Installing SAM CLI..."
      - pip install aws-sam-cli==1.142.1

  pre_build:
    commands:
      - echo "AWS SAM starting the build."

  build:
    commands:
      - ./codepipeline/scripts/build.sh
      
  post_build:
    commands:
      - echo "End of build phase"

artifacts:
  files:
    - 'serverless-app-sam/.aws-sam/build/**/*'    # ‚Üê ALL dependencies included here!
    - 'serverless-app-sam/samconfig.toml'         
    - 'codepipeline/**/*' 
    - 'serverless-app-sam/events/**/*'  # Include events for testing                  
  name: BuildArtifact

